*R2
set
i   Index of facilities/1*15/
alias (i,k);

set
j   Index of products/1*20/
alias (l,j);


parameters
b(i)  Index of capacities/
1        100
2        90
3        93
4        208
5        119
6        200
7        128
8        175
9        100
10       170
11       130
12       99
13       120
14       130
15       81/;
table
c(i,j)  the cost of assignment
         1          2         3          4          5          6          7         8          9         10        11         12        13         14         15        16         17        18         19         20
1        245        43        212        147        226        105        23        181        32        41        126        40        165        92         63        294        26        188        33         183
2        272        127       10         134        77         59         17        79         289       261       15         283       89         153        91        132        79        204        197        186
3        39         275       84         194        152        76         160       197        2         174       271        287       224        154        142       34         241       119        149        258
4        275        238       14         213        210        185        234       207        233       165       284        173       57         246        70        78         9         111        234        242
5        190        288       30         227        268        142        281       225        246       44        148        18        207        239        254       123        279       297        215        174
6        30         197       248        83         288        106        39        136        261       256       147        71        56         194        59        179        220       12         272        55
7        84         11        209        204        165        250        171       26         26        187       102        106       111        114        68        79         147       266        268        72
8        165        255       96         197        42         176        141       69         120       106       271        247       188        244        52        181        174       274        101        266
9        288        281       286        49         45         165        4         275        78        154       111        5         235        160        69        214        72        239        210        9
10       290        204       11         36         78         276        102       46         241       121       34         13        25         106        131       67         138       30         60         147
11       48         228       132        150        253        86         49        248        130       23        235        51        279        282        94        36         289       79         10         51
12       292        223       115        288        77         228        239       162        274       72        117        195       233        263        278       90         165       101        224        294
13       288        118       230        103        245        227        94        299        55        37        73         220       147        166        130       96         157       204        151        214
14       146        197       239        176        74         115        159       24         80        56        122        195       131        187        56        128        70        41         144        151
15       241        52        57         68         279        171        50        133        44        72        29         136       135        177        272       153        147       217        272        142;

table
a(i,j)  the resource of products
         1       2       3         4         5        6        7         8         9         10        11        12        13        14        15        16        17        18       19        20
1        3       16      11        15        2        5        32        25        28        24        33        22        23        15        20        28        13        1        28        15
2        24      16      16        20        20       21       31        23        15        11        1         7         24        30        23        33        6         12       34        27
3        2       29      1         33        31       8        29        2         4         24        17        26        23        30        20        35        21        15       12        29
4        3       3       35        15        24       14       10        3         10        25        15        9         34        9         26        7         10        10       24        28
5        19      5       6         35        7        21       21        12        6         3         17        33        8         22        19        5         2         7        16        12
6        4       7       4         11        13       9        1         19        10        9         27        10        25        21        35        25        27        29       30        19
7        29      14      14        25        17       11       15        23        16        8         12        27        9         19        8         4         9         16       27        4
8        29      30      7         24        35       22       11        15        19        24        28        7         5         31        4         19        16        32       6         4
9        26      29      18        19        6        10       6         29        17        30        17        11        22        10        4         19        25        14       31        5
10       6       3       12        25        30       29       7         26        31        13        2         4         16        12        3         31        13        27       35        24
11       24      14      34        24        23       35       15        34        19        28        7         21        17        5         15        17        26        14       19        18
12       19      19      33        7         14       26       4         19        34        24        26        24        24        33        16        14        14        29       31        7
13       35      15      2         5         7        13       21        12        23        1         17        20        27        23        13        24        24        27       21        18
14       23      23      26        35        15       21       17        4         34        22        6         15        13        17        27        26        25        14       6         6
15       29      22      10        6         17       4        25        22        9         14        12        23        24        23        22        19        16        8        7         2;

table
d(i,k)  Distance between the facilities
         1                       2                       3                       4                       5                       6                       7                       8                       9                       10                      11                      12                      13                      14                      15
1        0                       32.4499614791759        69.8569967862919        39.3573373083089        97.3087868591527        81.8352002502591        37.3630833845388        28.0713376952364        44.7213595499958        57.7234787586472        45.1774279923061        46.1735855224608        88.4816365128946        68.6585755750875        85.8836422143356
2        32.4499614791759        0                       53.2634959423431        8                       66.8879660327626        51.8844870842914        29.4108823397055        26.9258240356725        31.0644491340181        55.9016994374947        13.3416640641263        17.4642491965730        59.6154342431555        40.1123422402632        53.7121960079831
3        69.8569967862919        53.2634959423431        0                       47.3814309619285        91.1975876873945        81.7863069223694        32.5576411921994        79.3221280602078        25.2982212813470        109.123782925630        46.4004310324807        38.4187454245971        90.8019823572151        31.0161248385416        56.5685424949238
4        39.3573373083089        8                       47.3814309619285        0                       63.0713881248859        48.7031826475437        28.0178514522438        34.4818792991333        27.5136329843952        62.0080639917100        5.83095189484530        9.84885780179610        57.0087712549569        32.1403173599764        46.5295604965274
5        97.3087868591527        66.8879660327626        91.1975876873945        63.0713881248859        0                       15.5563491861040        88.8875694346516        76.2167960491649        84.9293824303462        78.3390068867356        58.3095189484530        63.6003144646314        12.1655250605964        60.2079728939615        37.6961536499415
6        81.8352002502591        51.8844870842914        81.7863069223694        48.7031826475437        15.5563491861040        0                       75.5049667240507        60.8029604542410        72.3394774656273        65.4904573201318        44.3846820423443        50.4876222454574        9.05538513813742        51.5460958754395        34.6554469023269
7        37.3630833845388        29.4108823397055        32.5576411921994        28.0178514522438        88.8875694346516        75.5049667240507        0                       50.9901951359279        8.24621125123532        82.8009661779378        31.2569992161756        25.2982212813470        84.1724420460759        39.8246155034798        64.0312423743285
8        28.0713376952364        26.9258240356725        79.3221280602078        34.4818792991333        76.2167960491649        60.8029604542410        50.9901951359279        0                       55.3172667437573        32.2490309931942        38.6393581727233        44.2718872423573        65.7951365983839        66.2872536767062        74.9666592559653
9        44.7213595499958        31.0644491340181        25.2982212813470        27.5136329843952        84.9293824303462        72.3394774656273        8.24621125123532        55.3172667437573        0                       86.3712915267567        29.2745623366089        22                      81.2219182240853        32.5269119345812        57.6888204074238
10       57.7234787586472        55.9016994374947        109.123782925630        62.0080639917100        78.3390068867356        65.4904573201318        82.8009661779378        32.2490309931942        86.3712915267567        0                       64.3506021727847        71.6100551598726        66.2193325245732        90.7854613911280        91.4111590562115
11       45.1774279923061        13.3416640641263        46.4004310324807        5.83095189484530        58.3095189484530        44.3846820423443        31.2569992161756        38.6393581727233        29.2745623366089        64.3506021727847        0                       8.06225774829855        52.9528091794949        27.6586333718787        40.7062648740952
12       46.1735855224608        17.4642491965730        38.4187454245971        9.84885780179610        63.6003144646314        50.4876222454574        25.2982212813470        44.2718872423573        22                      71.6100551598726        8.06225774829855        0                       59.3043000127310        23.0217288664427        41.2310562561766
13       88.4816365128946        59.6154342431555        90.8019823572151        57.0087712549569        12.1655250605964        9.05538513813742        84.1724420460759        65.7951365983839        81.2219182240853        66.2193325245732        52.9528091794949        59.3043000127310        0                       60.4400529450463        42.0119030752000
14       68.6585755750875        40.1123422402632        31.0161248385416        32.1403173599764        60.2079728939615        51.5460958754395        39.8246155034798        66.2872536767062        32.5269119345812        90.7854613911280        27.6586333718787        23.0217288664427        60.4400529450463        0                       26.5706605111728
15       85.8836422143356        53.7121960079831        56.5685424949238        46.5295604965274        37.6961536499415        34.6554469023269        64.0312423743285        74.9666592559653        57.6888204074238        91.4111590562115        40.7062648740952        41.2310562561766        42.0119030752000        26.5706605111728        0;
table
f(j,l)  Flow between the products
         1                       2                       3                       4                       5                       6                       7                       8                       9                       10                      11                      12                      13                      14                      15                      16                      17                      18                      19                      20
1        0                       5                       4.12310562561766        2.23606797749979        2                       7.07106781186548        2.23606797749979        1                       6.08276253029822        2.23606797749979        6.40312423743285        6.70820393249937        4.47213595499958        8.60232526704263        6.40312423743285        5.09901951359278        4.47213595499958        10                      10.6301458127347        7.28010988928052
2        5                       0                       3.16227766016838        3.16227766016838        3.60555127546399        5                       5.83095189484530        5.65685424949238        4.47213595499958        4.47213595499958        1.41421356237310        2                       5                       4.12310562561766        2                       3.60555127546399        5                       5                       5.65685424949238        4.47213595499958
3        4.12310562561766        3.16227766016838        0                       2                       4.12310562561766        3                       6                       5.09901951359278        7.07106781186548        5.09901951359278        4                       5.09901951359278        6.70820393249937        5                       3.16227766016838        1                       6.70820393249937        7.28010988928052        7.61577310586391        3.16227766016838
4        2.23606797749979        3.16227766016838        2                       0                       2.23606797749979        5                       4                       3.16227766016838        5.83095189484530        3.16227766016838        4.47213595499958        5.09901951359278        5                       6.40312423743285        4.24264068711929        3                       5                       8.06225774829855        8.60232526704263        5.09901951359278
5        2                       3.60555127546399        4.12310562561766        2.23606797749979        0                       7.07106781186548        2.23606797749979        2.23606797749979        4.12310562561766        1                       5                       5                       2.82842712474619        7.61577310586391        5.38516480713450        5.09901951359278        2.82842712474619        8.48528137423857        9.21954445729289        7
6        7.07106781186548        5                       3                       5                       7.07106781186548        0                       9                       8.06225774829855        9.43398113205660        8.06225774829855        5                       6.40312423743285        9.48683298050514        4                       3.60555127546399        2                       9.48683298050514        7.07106781186548        7                       1
7        2.23606797749979        5.83095189484530        6                       4                       2.23606797749979        9                       0                       1.41421356237310        5.09901951359278        1.41421356237310        7.21110255092798        7.07106781186548        3                       9.84885780179610        7.61577310586391        7                       3                       10.6301458127347        11.4017542509914        9.05538513813742
8        1                       5.65685424949238        5.09901951359278        3.16227766016838        2.23606797749979        8.06225774829855        1.41421356237310        0                       6                       2                       7.07106781186548        7.21110255092798        4.12310562561766        9.43398113205660        7.21110255092798        6.08276253029822        4.12310562561766        10.6301458127347        11.3137084989848        8.24621125123532
9        6.08276253029822        4.47213595499958        7.07106781186548        5.83095189484530        4.12310562561766        9.43398113205660        5.09901951359278        6                       0                       4                       5.09901951359278        4                       2.23606797749979        8.06225774829855        6.32455532033676        7.81024967590665        2.23606797749979        7.28010988928052        8.24621125123532        8.94427190999916
10       2.23606797749979        4.47213595499958        5.09901951359278        3.16227766016838        1                       8.06225774829855        1.41421356237310        2                       4                       0                       5.83095189484530        5.65685424949238        2.23606797749979        8.54400374531753        6.32455532033676        6.08276253029822        2.23606797749979        9.21954445729289        10                      8
11       6.40312423743285        1.41421356237310        4                       4.47213595499958        5                       5                       7.21110255092798        7.07106781186548        5.09901951359278        5.83095189484530        0                       1.41421356237310        6.08276253029822        3                       1.41421356237310        4.12310562561766        6.08276253029822        3.60555127546399        4.24264068711929        4.24264068711929
12       6.70820393249937        2                       5.09901951359278        5.09901951359278        5                       6.40312423743285        7.07106781186548        7.21110255092798        4                       5.65685424949238        1.41421356237310        0                       5.38516480713450        4.12310562561766        2.82842712474619        5.38516480713450        5.38516480713450        3.60555127546399        4.47213595499958        5.65685424949238
13       4.47213595499958        5                       6.70820393249937        5                       2.82842712474619        9.48683298050514        3                       4.12310562561766        2.23606797749979        2.23606797749979        6.08276253029822        5.38516480713450        0                       9.05538513813742        7                       7.61577310586391        0                       8.94427190999916        9.84885780179610        9.21954445729289
14       8.60232526704263        4.12310562561766        5                       6.40312423743285        7.61577310586391        4                       9.84885780179610        9.43398113205660        8.06225774829855        8.54400374531753        3                       4.12310562561766        9.05538513813742        0                       2.23606797749979        4.47213595499958        9.05538513813742        3.16227766016838        3                       3
15       6.40312423743285        2                       3.16227766016838        4.24264068711929        5.38516480713450        3.60555127546399        7.61577310586391        7.21110255092798        6.32455532033676        6.32455532033676        1.41421356237310        2.82842712474619        7                       2.23606797749979        0                       3                       7                       4.12310562561766        4.47213595499958        2.82842712474619
16       5.09901951359278        3.60555127546399        1                       3                       5.09901951359278        2                       7                       6.08276253029822        7.81024967590665        6.08276253029822        4.12310562561766        5.38516480713450        7.61577310586391        4.47213595499958        3                       0                       7.61577310586391        7.07106781186548        7.28010988928052        2.23606797749979
17       4.47213595499958        5                       6.70820393249937        5                       2.82842712474619        9.48683298050514        3                       4.12310562561766        2.23606797749979        2.23606797749979        6.08276253029822        5.38516480713450        0                       9.05538513813742        7                       7.61577310586391        0                       8.94427190999916        9.84885780179610        9.21954445729289
18       10                      5                       7.28010988928052        8.06225774829855        8.48528137423857        7.07106781186548        10.6301458127347        10.6301458127347        7.28010988928052        9.21954445729289        3.60555127546399        3.60555127546399        8.94427190999916        3.16227766016838        4.12310562561766        7.07106781186548        8.94427190999916        0                       1                       6.08276253029822
19       10.6301458127347        5.65685424949238        7.61577310586391        8.60232526704263        9.21954445729289        7                       11.4017542509914        11.3137084989848        8.24621125123532        10                      4.24264068711929        4.47213595499958        9.84885780179610        3                       4.47213595499958        7.28010988928052        9.84885780179610        1                       0                       6
20       7.28010988928052        4.47213595499958        3.16227766016838        5.09901951359278        7                       1                       9.05538513813742        8.24621125123532        8.94427190999916        8                       4.24264068711929        5.65685424949238        9.21954445729289        3                       2.82842712474619        2.23606797749979        9.21954445729289        6.08276253029822        6                       0;
variable
z        cost
q(i,j,k,l)  New variable;
binary variable
x(i,j)      The assignment;
Positive variable q;
equation
objective
e1
e2
e3
e4;
objective..z=e=sum((i,j),c(i,j)*x(i,j))+sum((i,j,k,l), d(i,k)*f(j,l)*q(i,j,k,l)) ;
e1(j)..sum(i,x(i,j))=e=1;
e2(i)..sum(j,x(i,j)*a(i,j))=l=b(i);
e3(j,l,k)..sum(i,q(i,j,k,l))=e=x(k,l);
e4(j,l,k)..sum(i,q(k,l,i,j))=e=x(k,l);


model    GQAPR2/all/
option
mip=cplex
RESLIM = 3600;
solve    GQAPR2      using   mip      minimizing      z;
display  x.l,z.l;
