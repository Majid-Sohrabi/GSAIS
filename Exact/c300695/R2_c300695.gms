*R2
set
i   Index of facilities/1*6/
alias (i,k);

set
j   Index of products/1*30/
alias (l,j);


parameters
b(i)  Index of capacities/
1        88
2        90
3        87
4        62
5        80
6        110/;
table
c(i,j)  the cost of assignment
         1          2          3          4          5          6          7          8          9          10         11         12         13         14         15         16         17         18         19         20         21         22         23         24         25         26         27         28         29         30
1        426        211        483        417        372        383        378        406        384        147        401        319        426        347        467        130        328        224        376        161        142        133        172        320        261        267        235        196        330        117
2        463        319        294        484        403        112        227        418        402        299        202        155        197        289        214        121        288        311        400        431        485        260        205        158        130        119        460        261        123        167
3        150        483        420        362        397        211        481        174        210        484        302        159        472        241        403        312        104        166        280        315        101        204        158        442        196        461        248        138        194        360
4        466        486        156        114        257        118        113        296        372        236        380        203        240        433        402        412        235        341        133        499        410        420        154        349        149        478        144        152        241        393
5        353        163        269        440        362        138        275        278        362        334        457        437        178        334        252        474        165        205        191        131        427        272        448        240        173        296        412        477        429        359
6        139        489        467        474        168        430        253        359        165        189        484        201        200        320        327        152        418        362        466        277        448        465        332        305        196        296        256        483        106        280;

table
a(i,j)  the resource of products
         1       2        3         4         5        6        7         8         9         10        11        12        13        14        15        16        17        18       19        20        21       22        23        24       25       26       27       28       29       30
1        11      8        10        17        8        5        5         9         6         5         2         10        11        8         2         3         18        11       17        10        2        17        20        2        2        6        8        2        9        14
2        6       13       9         16        19       7        4         4         9         3         6         12        5         20        6         14        7         10       12        4         14       17        13        3        8        9        4        15       20       14
3        15      16       9         13        18       10       5         19        12        6         17        5         10        1         7         10        14        19       4         20        1        15        17        4        11       1        10       6        7        4
4        4       2        7         8         12       5        9         20        6         7         1         10        13        18        14        16        4         13       5         15        2        3         10        8        9        20       7        9        15       3
5        14      19       11        17        13       17       7         9         13        9         19        20        14        19        3         15        1         13       18        11        11       14        9         17       14       4        20       11       14       20
6        4       16       11        11        12       4        19        3         15        11        15        11        8         16        15        19        15        18       1         10        2        11        17        17       13       3        19       19       11       4;

table
d(i,k)  Distance between the facilities
         1                       2                       3                       4                       5                       6
1        0                       32.4499614791759        69.8569967862919        39.3573373083089        97.3087868591527        81.8352002502591
2        32.4499614791759        0                       53.2634959423431        8                       66.8879660327626        51.8844870842914
3        69.8569967862919        53.2634959423431        0                       47.3814309619285        91.1975876873945        81.7863069223694
4        39.3573373083089        8                       47.3814309619285        0                       63.0713881248859        48.7031826475437
5        97.3087868591527        66.8879660327626        91.1975876873945        63.0713881248859        0                       15.5563491861040
6        81.8352002502591        51.8844870842914        81.7863069223694        48.7031826475437        15.5563491861040        0;
table
f(j,l)  Flow between the products
         1                       2                       3                       4                       5                       6                       7                       8                       9                       10                      11                      12                      13                      14                      15                      16                      17                      18                      19                      20                      21                      22                      23                      24                      25                      26                      27                      28                      29                      30
1        0                       5.09901951359278        8.06225774829855        9.21954445729289        4.12310562561766        9.48683298050514        6.40312423743285        10.8166538263920        8.06225774829855        11.3137084989848        7.81024967590665        9.48683298050514        4.12310562561766        6.40312423743285        5                       3.16227766016838        5.83095189484530        9.21954445729289        9.48683298050514        7.81024967590665        4.47213595499958        3.60555127546399        7.81024967590665        2.23606797749979        8.24621125123532        9                       8.06225774829855        6.70820393249937        9.43398113205660        3.16227766016838
2        5.09901951359278        0                       3                       6.08276253029822        5                       8.24621125123532        4.12310562561766        6.40312423743285        8.06225774829855        7.61577310586391        4.12310562561766        8.24621125123532        5                       4.12310562561766        2.23606797749979        4.47213595499958        2                       8.54400374531753        8.24621125123532        5                       4.24264068711929        3.60555127546399        4.12310562561766        3                       3.16227766016838        4.12310562561766        3.60555127546399        5.38516480713450        7                       4.47213595499958
3        8.06225774829855        3                       0                       6.32455532033676        7.61577310586391        9.43398113205660        5.65685424949238        5.09901951359278        9.89949493661167        7                       4.47213595499958        9.43398113205660        7.61577310586391        5.65685424949238        4.47213595499958        7.28010988928052        3.60555127546399        10                      9.43398113205660        5.83095189484530        6.70820393249937        6.32455532033676        4.47213595499958        6                       1                       1.41421356237310        3.16227766016838        7.07106781186548        7.61577310586391        7.28010988928052
4        9.21954445729289        6.08276253029822        6.32455532033676        0                       5.83095189484530        3.60555127546399        2.82842712474619        3.16227766016838        5.09901951359278        2.23606797749979        2                       3.60555127546399        5.83095189484530        2.82842712474619        4.47213595499958        6.40312423743285        4.12310562561766        4.47213595499958        3.60555127546399        1.41421356237310        5                       5.65685424949238        2                       7.21110255092798        5.38516480713450        7.61577310586391        3.16227766016838        3.16227766016838        1.41421356237310        6.40312423743285
5        4.12310562561766        5                       7.61577310586391        5.83095189484530        0                       5.38516480713450        3.16227766016838        8.24621125123532        4                       8.06225774829855        5.09901951359278        5.38516480713450        0                       3.16227766016838        3.16227766016838        1                       4.12310562561766        5.09901951359278        5.38516480713450        4.47213595499958        1                       1.41421356237310        5.09901951359278        3.16227766016838        7.28010988928052        8.94427190999916        6                       2.82842712474619        5.65685424949238        1
6        9.48683298050514        8.24621125123532        9.43398113205660        3.60555127546399        5.38516480713450        0                       4.12310562561766        6.70820393249937        2.23606797749979        5.09901951359278        5                       0                       5.38516480713450        4.12310562561766        6.08276253029822        6.32455532033676        6.32455532033676        1                       0                       3.60555127546399        5.09901951359278        6.08276253029822        5                       8.06225774829855        8.60232526704263        10.8166538263920        6.40312423743285        3                       2.23606797749979        6.32455532033676
7        6.40312423743285        4.12310562561766        5.65685424949238        2.82842712474619        3.16227766016838        4.12310562561766        0                       5.09901951359278        4.24264068711929        5                       2                       4.12310562561766        3.16227766016838        0                       2                       3.60555127546399        2.23606797749979        4.47213595499958        4.12310562561766        1.41421356237310        2.23606797749979        2.82842712474619        2                       4.47213595499958        5                       7.07106781186548        3.16227766016838        1.41421356237310        3.16227766016838        3.60555127546399
8        10.8166538263920        6.40312423743285        5.09901951359278        3.16227766016838        8.24621125123532        6.70820393249937        5.09901951359278        0                       8.24621125123532        2.23606797749979        3.16227766016838        6.70820393249937        8.24621125123532        5.09901951359278        5.83095189484530        8.54400374531753        5                       7.61577310586391        6.70820393249937        4                       7.28010988928052        7.61577310586391        3.16227766016838        8.60232526704263        4.12310562561766        6                       2.82842712474619        6                       4.47213595499958        8.54400374531753
9        8.06225774829855        8.06225774829855        9.89949493661167        5.09901951359278        4                       2.23606797749979        4.24264068711929        8.24621125123532        0                       7                       5.83095189484530        2.23606797749979        4                       4.24264068711929        5.83095189484530        5                       6.40312423743285        1.41421356237310        2.23606797749979        4.47213595499958        4.12310562561766        5.09901951359278        5.83095189484530        7.07106781186548        9.21954445729289        11.3137084989848        7.21110255092798        2.82842712474619        4                       5
10       11.3137084989848        7.61577310586391        7                       2.23606797749979        8.06225774829855        5.09901951359278        5                       2.23606797749979        7                       0                       3.60555127546399        5.09901951359278        8.06225774829855        5                       6.40312423743285        8.60232526704263        5.83095189484530        6.08276253029822        5.09901951359278        3.60555127546399        7.21110255092798        7.81024967590665        3.60555127546399        9.21954445729289        6                       8.06225774829855        4.12310562561766        5.38516480713450        3                       8.60232526704263
11       7.81024967590665        4.12310562561766        4.47213595499958        2                       5.09901951359278        5                       2                       3.16227766016838        5.83095189484530        3.60555127546399        0                       5                       5.09901951359278        2                       2.82842712474619        5.38516480713450        2.23606797749979        5.65685424949238        5                       1.41421356237310        4.12310562561766        4.47213595499958        0                       5.65685424949238        3.60555127546399        5.83095189484530        1.41421356237310        3.16227766016838        3.16227766016838        5.38516480713450
12       9.48683298050514        8.24621125123532        9.43398113205660        3.60555127546399        5.38516480713450        0                       4.12310562561766        6.70820393249937        2.23606797749979        5.09901951359278        5                       0                       5.38516480713450        4.12310562561766        6.08276253029822        6.32455532033676        6.32455532033676        1                       0                       3.60555127546399        5.09901951359278        6.08276253029822        5                       8.06225774829855        8.60232526704263        10.8166538263920        6.40312423743285        3                       2.23606797749979        6.32455532033676
13       4.12310562561766        5                       7.61577310586391        5.83095189484530        0                       5.38516480713450        3.16227766016838        8.24621125123532        4                       8.06225774829855        5.09901951359278        5.38516480713450        0                       3.16227766016838        3.16227766016838        1                       4.12310562561766        5.09901951359278        5.38516480713450        4.47213595499958        1                       1.41421356237310        5.09901951359278        3.16227766016838        7.28010988928052        8.94427190999916        6                       2.82842712474619        5.65685424949238        1
14       6.40312423743285        4.12310562561766        5.65685424949238        2.82842712474619        3.16227766016838        4.12310562561766        0                       5.09901951359278        4.24264068711929        5                       2                       4.12310562561766        3.16227766016838        0                       2                       3.60555127546399        2.23606797749979        4.47213595499958        4.12310562561766        1.41421356237310        2.23606797749979        2.82842712474619        2                       4.47213595499958        5                       7.07106781186548        3.16227766016838        1.41421356237310        3.16227766016838        3.60555127546399
15       5                       2.23606797749979        4.47213595499958        4.47213595499958        3.16227766016838        6.08276253029822        2                       5.83095189484530        5.83095189484530        6.40312423743285        2.82842712474619        6.08276253029822        3.16227766016838        2                       0                       3                       1                       6.32455532033676        6.08276253029822        3.16227766016838        2.23606797749979        2                       2.82842712474619        2.82842712474619        4.12310562561766        5.83095189484530        3.16227766016838        3.16227766016838        5.09901951359278        3
16       3.16227766016838        4.47213595499958        7.28010988928052        6.40312423743285        1                       6.32455532033676        3.60555127546399        8.54400374531753        5                       8.60232526704263        5.38516480713450        6.32455532033676        1                       3.60555127546399        3                       0                       4                       6.08276253029822        6.32455532033676        5                       1.41421356237310        1                       5.38516480713450        2.23606797749979        7.07106781186548        8.54400374531753        6.08276253029822        3.60555127546399        6.40312423743285        0
17       5.83095189484530        2                       3.60555127546399        4.12310562561766        4.12310562561766        6.32455532033676        2.23606797749979        5                       6.40312423743285        5.83095189484530        2.23606797749979        6.32455532033676        4.12310562561766        2.23606797749979        1                       4                       0                       6.70820393249937        6.32455532033676        3                       3.16227766016838        3                       2.23606797749979        3.60555127546399        3.16227766016838        5                       2.23606797749979        3.60555127546399        5                       4
18       9.21954445729289        8.54400374531753        10                      4.47213595499958        5.09901951359278        1                       4.47213595499958        7.61577310586391        1.41421356237310        6.08276253029822        5.65685424949238        1                       5.09901951359278        4.47213595499958        6.32455532033676        6.08276253029822        6.70820393249937        0                       1                       4.24264068711929        5                       6                       5.65685424949238        8                       9.21954445729289        11.4017542509914        7.07106781186548        3.16227766016838        3.16227766016838        6.08276253029822
19       9.48683298050514        8.24621125123532        9.43398113205660        3.60555127546399        5.38516480713450        0                       4.12310562561766        6.70820393249937        2.23606797749979        5.09901951359278        5                       0                       5.38516480713450        4.12310562561766        6.08276253029822        6.32455532033676        6.32455532033676        1                       0                       3.60555127546399        5.09901951359278        6.08276253029822        5                       8.06225774829855        8.60232526704263        10.8166538263920        6.40312423743285        3                       2.23606797749979        6.32455532033676
20       7.81024967590665        5                       5.83095189484530        1.41421356237310        4.47213595499958        3.60555127546399        1.41421356237310        4                       4.47213595499958        3.60555127546399        1.41421356237310        3.60555127546399        4.47213595499958        1.41421356237310        3.16227766016838        5                       3                       4.24264068711929        3.60555127546399        0                       3.60555127546399        4.24264068711929        1.41421356237310        5.83095189484530        5                       7.21110255092798        2.82842712474619        2                       2                       5
21       4.47213595499958        4.24264068711929        6.70820393249937        5                       1                       5.09901951359278        2.23606797749979        7.28010988928052        4.12310562561766        7.21110255092798        4.12310562561766        5.09901951359278        1                       2.23606797749979        2.23606797749979        1.41421356237310        3.16227766016838        5                       5.09901951359278        3.60555127546399        0                       1                       4.12310562561766        3                       6.32455532033676        8.06225774829855        5                       2.23606797749979        5                       1.41421356237310
22       3.60555127546399        3.60555127546399        6.32455532033676        5.65685424949238        1.41421356237310        6.08276253029822        2.82842712474619        7.61577310586391        5.09901951359278        7.81024967590665        4.47213595499958        6.08276253029822        1.41421356237310        2.82842712474619        2                       1                       3                       6                       6.08276253029822        4.24264068711929        1                       0                       4.47213595499958        2                       6.08276253029822        7.61577310586391        5.09901951359278        3.16227766016838        5.83095189484530        1
23       7.81024967590665        4.12310562561766        4.47213595499958        2                       5.09901951359278        5                       2                       3.16227766016838        5.83095189484530        3.60555127546399        0                       5                       5.09901951359278        2                       2.82842712474619        5.38516480713450        2.23606797749979        5.65685424949238        5                       1.41421356237310        4.12310562561766        4.47213595499958        0                       5.65685424949238        3.60555127546399        5.83095189484530        1.41421356237310        3.16227766016838        3.16227766016838        5.38516480713450
24       2.23606797749979        3                       6                       7.21110255092798        3.16227766016838        8.06225774829855        4.47213595499958        8.60232526704263        7.07106781186548        9.21954445729289        5.65685424949238        8.06225774829855        3.16227766016838        4.47213595499958        2.82842712474619        2.23606797749979        3.60555127546399        8                       8.06225774829855        5.83095189484530        3                       2                       5.65685424949238        0                       6.08276253029822        7.07106781186548        5.83095189484530        5.09901951359278        7.61577310586391        2.23606797749979
25       8.24621125123532        3.16227766016838        1                       5.38516480713450        7.28010988928052        8.60232526704263        5                       4.12310562561766        9.21954445729289        6                       3.60555127546399        8.60232526704263        7.28010988928052        5                       4.12310562561766        7.07106781186548        3.16227766016838        9.21954445729289        8.60232526704263        5                       6.32455532033676        6.08276253029822        3.60555127546399        6.08276253029822        0                       2.23606797749979        2.23606797749979        6.40312423743285        6.70820393249937        7.07106781186548
26       9                       4.12310562561766        1.41421356237310        7.61577310586391        8.94427190999916        10.8166538263920        7.07106781186548        6                       11.3137084989848        8.06225774829855        5.83095189484530        10.8166538263920        8.94427190999916        7.07106781186548        5.83095189484530        8.54400374531753        5                       11.4017542509914        10.8166538263920        7.21110255092798        8.06225774829855        7.61577310586391        5.83095189484530        7.07106781186548        2.23606797749979        0                       4.47213595499958        8.48528137423857        8.94427190999916        8.54400374531753
27       8.06225774829855        3.60555127546399        3.16227766016838        3.16227766016838        6                       6.40312423743285        3.16227766016838        2.82842712474619        7.21110255092798        4.12310562561766        1.41421356237310        6.40312423743285        6                       3.16227766016838        3.16227766016838        6.08276253029822        2.23606797749979        7.07106781186548        6.40312423743285        2.82842712474619        5                       5.09901951359278        1.41421356237310        5.83095189484530        2.23606797749979        4.47213595499958        0                       4.47213595499958        4.47213595499958        6.08276253029822
28       6.70820393249937        5.38516480713450        7.07106781186548        3.16227766016838        2.82842712474619        3                       1.41421356237310        6                       2.82842712474619        5.38516480713450        3.16227766016838        3                       2.82842712474619        1.41421356237310        3.16227766016838        3.60555127546399        3.60555127546399        3.16227766016838        3                       2                       2.23606797749979        3.16227766016838        3.16227766016838        5.09901951359278        6.40312423743285        8.48528137423857        4.47213595499958        0                       2.82842712474619        3.60555127546399
29       9.43398113205660        7                       7.61577310586391        1.41421356237310        5.65685424949238        2.23606797749979        3.16227766016838        4.47213595499958        4                       3                       3.16227766016838        2.23606797749979        5.65685424949238        3.16227766016838        5.09901951359278        6.40312423743285        5                       3.16227766016838        2.23606797749979        2                       5                       5.83095189484530        3.16227766016838        7.61577310586391        6.70820393249937        8.94427190999916        4.47213595499958        2.82842712474619        0                       6.40312423743285
30       3.16227766016838        4.47213595499958        7.28010988928052        6.40312423743285        1                       6.32455532033676        3.60555127546399        8.54400374531753        5                       8.60232526704263        5.38516480713450        6.32455532033676        1                       3.60555127546399        3                       0                       4                       6.08276253029822        6.32455532033676        5                       1.41421356237310        1                       5.38516480713450        2.23606797749979        7.07106781186548        8.54400374531753        6.08276253029822        3.60555127546399        6.40312423743285        0;
variable
z        cost
q(i,j,k,l)  New variable;
binary variable
x(i,j)      The assignment;
Positive variable q;
equation
objective
e1
e2
e3
e4;
objective..z=e=sum((i,j),c(i,j)*x(i,j))+sum((i,j,k,l), d(i,k)*f(j,l)*q(i,j,k,l)) ;
e1(j)..sum(i,x(i,j))=e=1;
e2(i)..sum(j,x(i,j)*a(i,j))=l=b(i);
e3(j,l,k)..sum(i,q(i,j,k,l))=e=x(k,l);
e4(j,l,k)..sum(i,q(k,l,i,j))=e=x(k,l);


model    GQAPR2/all/
option
mip=cplex
RESLIM = 3600;
solve    GQAPR2      using   mip      minimizing      z;
display  x.l,z.l;
