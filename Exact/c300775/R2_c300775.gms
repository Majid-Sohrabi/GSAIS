*R2
set
i   Index of facilities/1*7/
alias (i,k);

set
j   Index of products/1*30/
alias (l,j);


parameters
b(i)  Index of capacities/
1        88
2        90
3        87
4        62
5        80
6        110
7        123/;
table
c(i,j)  the cost of assignment
         1          2          3          4          5          6          7          8          9          10         11         12         13         14         15         16         17         18         19         20         21         22         23         24         25         26         27         28         29         30
1        238        168        87         82         189        236        153        277        212        285        148        254        109        201        50         236        167        166        88         217        250        232        143        268        241        159        281        263        159        207
2        138        148        209        207        128        110        62         95         173        78         206        92         53         172        37         282        169        117        144        144        140        126        254        185        109        73         215        192        273        43
3        45         265        101        257        277        240        115        235        139        219        236        192        284        222        133        293        261        62         213        25         269        80         236        63         170        159        183        298        181        195
4        94         165        208        116        20         152        190        73         201        86         118        183        201        166        145        73         156        184        120        112        129        242        66         76         45         61         249        168        257        205
5        63         285        215        239        149        30         73         100        201        53         206        171        154        299        122        59         130        93         226        139        236        286        262        134        51         35         267        154        227        225
6        98         199        39         209        139        69         227        45         210        190        136        264        199        81         234        215        208        32         130        95         131        112        298        230        58         259        297        245        184        270
7        143        289        91         21         149        222        88         181        198        146        256        94         173        49         196        46         228        232        212        75         247        208        164        251        210        177        20         84         89         296;

table
a(i,j)  the resource of products
         1       2        3         4         5        6        7         8         9         10        11        12        13        14        15        16        17        18        19        20        21       22        23        24       25       26       27       28       29       30
1        24      15       11        6         17       7        4         22        24        10        17        10        9         11        21        6         8         10        9         24        23       22        24        15       24       20       23       18       12       4
2        18      26       2         2         14       17       5         23        16        9         26        27        13        2         15        18        2         14        2         28        1        24        11        27       29       10       30       24       17       9
3        28      7        15        20        4        20       5         2         6         10        11        4         14        16        28        9         14        4         16        17        2        9         19        24       21       20       27       12       7        8
4        18      17       6         9         15       13       19        26        12        15        14        30        23        11        4         5         1         30        23        4         21       21        23        23       4        23       3        7        20       16
5        1       19       4         17        26       7        18        29        5         20        2         17        25        6         23        7         27        10        19        25        19       17        4         2        22       18       11       3        15       3
6        4       1        7         21        27       29       2         30        1         1         6         22        4         7         23        27        6         9         3         11        16       12        4         3        4        23       12       24       5        13
7        26      19       5         15        9        3        28        26        29        26        20        30        6         28        17        3         3         2         3         9         22       2         17        3        4        8        21       7        24       4;

table
d(i,k)  Distance between the facilities
         1                       2                       3                       4                       5                       6                       7
1        0                       32.4499614791759        69.8569967862919        39.3573373083089        97.3087868591527        81.8352002502591        67
2        32.4499614791759        0                       53.2634959423431        8                       66.8879660327626        51.8844870842914        55.9464029227975
3        69.8569967862919        53.2634959423431        0                       47.3814309619285        91.1975876873945        81.7863069223694        107.298648640139
4        39.3573373083089        8                       47.3814309619285        0                       63.0713881248859        48.7031826475437        60.2162768692984
5        97.3087868591527        66.8879660327626        91.1975876873945        63.0713881248859        0                       15.5563491861040        62.5139984323511
6        81.8352002502591        51.8844870842914        81.7863069223694        48.7031826475437        15.5563491861040        0                       51.0881590977792
7        67                      55.9464029227975        107.298648640139        60.2162768692984        62.5139984323511        51.0881590977792        0;
table
f(j,l)  Flow between the products
         1                       2                       3                       4                       5                       6                       7                       8                       9                       10                      11                      12                      13                      14                      15                      16                      17                      18                      19                      20                      21                      22                      23                      24                      25                      26                      27                      28                      29                      30
1        0                       5.09901951359278        8.06225774829855        9.21954445729289        4.12310562561766        9.48683298050514        6.40312423743285        10.8166538263920        8.06225774829855        11.3137084989848        7.81024967590665        9.48683298050514        4.12310562561766        6.40312423743285        5                       3.16227766016838        5.83095189484530        9.21954445729289        9.48683298050514        7.81024967590665        4.47213595499958        3.60555127546399        7.81024967590665        2.23606797749979        8.24621125123532        9                       8.06225774829855        6.70820393249937        9.43398113205660        3.16227766016838
2        5.09901951359278        0                       3                       6.08276253029822        5                       8.24621125123532        4.12310562561766        6.40312423743285        8.06225774829855        7.61577310586391        4.12310562561766        8.24621125123532        5                       4.12310562561766        2.23606797749979        4.47213595499958        2                       8.54400374531753        8.24621125123532        5                       4.24264068711929        3.60555127546399        4.12310562561766        3                       3.16227766016838        4.12310562561766        3.60555127546399        5.38516480713450        7                       4.47213595499958
3        8.06225774829855        3                       0                       6.32455532033676        7.61577310586391        9.43398113205660        5.65685424949238        5.09901951359278        9.89949493661167        7                       4.47213595499958        9.43398113205660        7.61577310586391        5.65685424949238        4.47213595499958        7.28010988928052        3.60555127546399        10                      9.43398113205660        5.83095189484530        6.70820393249937        6.32455532033676        4.47213595499958        6                       1                       1.41421356237310        3.16227766016838        7.07106781186548        7.61577310586391        7.28010988928052
4        9.21954445729289        6.08276253029822        6.32455532033676        0                       5.83095189484530        3.60555127546399        2.82842712474619        3.16227766016838        5.09901951359278        2.23606797749979        2                       3.60555127546399        5.83095189484530        2.82842712474619        4.47213595499958        6.40312423743285        4.12310562561766        4.47213595499958        3.60555127546399        1.41421356237310        5                       5.65685424949238        2                       7.21110255092798        5.38516480713450        7.61577310586391        3.16227766016838        3.16227766016838        1.41421356237310        6.40312423743285
5        4.12310562561766        5                       7.61577310586391        5.83095189484530        0                       5.38516480713450        3.16227766016838        8.24621125123532        4                       8.06225774829855        5.09901951359278        5.38516480713450        0                       3.16227766016838        3.16227766016838        1                       4.12310562561766        5.09901951359278        5.38516480713450        4.47213595499958        1                       1.41421356237310        5.09901951359278        3.16227766016838        7.28010988928052        8.94427190999916        6                       2.82842712474619        5.65685424949238        1
6        9.48683298050514        8.24621125123532        9.43398113205660        3.60555127546399        5.38516480713450        0                       4.12310562561766        6.70820393249937        2.23606797749979        5.09901951359278        5                       0                       5.38516480713450        4.12310562561766        6.08276253029822        6.32455532033676        6.32455532033676        1                       0                       3.60555127546399        5.09901951359278        6.08276253029822        5                       8.06225774829855        8.60232526704263        10.8166538263920        6.40312423743285        3                       2.23606797749979        6.32455532033676
7        6.40312423743285        4.12310562561766        5.65685424949238        2.82842712474619        3.16227766016838        4.12310562561766        0                       5.09901951359278        4.24264068711929        5                       2                       4.12310562561766        3.16227766016838        0                       2                       3.60555127546399        2.23606797749979        4.47213595499958        4.12310562561766        1.41421356237310        2.23606797749979        2.82842712474619        2                       4.47213595499958        5                       7.07106781186548        3.16227766016838        1.41421356237310        3.16227766016838        3.60555127546399
8        10.8166538263920        6.40312423743285        5.09901951359278        3.16227766016838        8.24621125123532        6.70820393249937        5.09901951359278        0                       8.24621125123532        2.23606797749979        3.16227766016838        6.70820393249937        8.24621125123532        5.09901951359278        5.83095189484530        8.54400374531753        5                       7.61577310586391        6.70820393249937        4                       7.28010988928052        7.61577310586391        3.16227766016838        8.60232526704263        4.12310562561766        6                       2.82842712474619        6                       4.47213595499958        8.54400374531753
9        8.06225774829855        8.06225774829855        9.89949493661167        5.09901951359278        4                       2.23606797749979        4.24264068711929        8.24621125123532        0                       7                       5.83095189484530        2.23606797749979        4                       4.24264068711929        5.83095189484530        5                       6.40312423743285        1.41421356237310        2.23606797749979        4.47213595499958        4.12310562561766        5.09901951359278        5.83095189484530        7.07106781186548        9.21954445729289        11.3137084989848        7.21110255092798        2.82842712474619        4                       5
10       11.3137084989848        7.61577310586391        7                       2.23606797749979        8.06225774829855        5.09901951359278        5                       2.23606797749979        7                       0                       3.60555127546399        5.09901951359278        8.06225774829855        5                       6.40312423743285        8.60232526704263        5.83095189484530        6.08276253029822        5.09901951359278        3.60555127546399        7.21110255092798        7.81024967590665        3.60555127546399        9.21954445729289        6                       8.06225774829855        4.12310562561766        5.38516480713450        3                       8.60232526704263
11       7.81024967590665        4.12310562561766        4.47213595499958        2                       5.09901951359278        5                       2                       3.16227766016838        5.83095189484530        3.60555127546399        0                       5                       5.09901951359278        2                       2.82842712474619        5.38516480713450        2.23606797749979        5.65685424949238        5                       1.41421356237310        4.12310562561766        4.47213595499958        0                       5.65685424949238        3.60555127546399        5.83095189484530        1.41421356237310        3.16227766016838        3.16227766016838        5.38516480713450
12       9.48683298050514        8.24621125123532        9.43398113205660        3.60555127546399        5.38516480713450        0                       4.12310562561766        6.70820393249937        2.23606797749979        5.09901951359278        5                       0                       5.38516480713450        4.12310562561766        6.08276253029822        6.32455532033676        6.32455532033676        1                       0                       3.60555127546399        5.09901951359278        6.08276253029822        5                       8.06225774829855        8.60232526704263        10.8166538263920        6.40312423743285        3                       2.23606797749979        6.32455532033676
13       4.12310562561766        5                       7.61577310586391        5.83095189484530        0                       5.38516480713450        3.16227766016838        8.24621125123532        4                       8.06225774829855        5.09901951359278        5.38516480713450        0                       3.16227766016838        3.16227766016838        1                       4.12310562561766        5.09901951359278        5.38516480713450        4.47213595499958        1                       1.41421356237310        5.09901951359278        3.16227766016838        7.28010988928052        8.94427190999916        6                       2.82842712474619        5.65685424949238        1
14       6.40312423743285        4.12310562561766        5.65685424949238        2.82842712474619        3.16227766016838        4.12310562561766        0                       5.09901951359278        4.24264068711929        5                       2                       4.12310562561766        3.16227766016838        0                       2                       3.60555127546399        2.23606797749979        4.47213595499958        4.12310562561766        1.41421356237310        2.23606797749979        2.82842712474619        2                       4.47213595499958        5                       7.07106781186548        3.16227766016838        1.41421356237310        3.16227766016838        3.60555127546399
15       5                       2.23606797749979        4.47213595499958        4.47213595499958        3.16227766016838        6.08276253029822        2                       5.83095189484530        5.83095189484530        6.40312423743285        2.82842712474619        6.08276253029822        3.16227766016838        2                       0                       3                       1                       6.32455532033676        6.08276253029822        3.16227766016838        2.23606797749979        2                       2.82842712474619        2.82842712474619        4.12310562561766        5.83095189484530        3.16227766016838        3.16227766016838        5.09901951359278        3
16       3.16227766016838        4.47213595499958        7.28010988928052        6.40312423743285        1                       6.32455532033676        3.60555127546399        8.54400374531753        5                       8.60232526704263        5.38516480713450        6.32455532033676        1                       3.60555127546399        3                       0                       4                       6.08276253029822        6.32455532033676        5                       1.41421356237310        1                       5.38516480713450        2.23606797749979        7.07106781186548        8.54400374531753        6.08276253029822        3.60555127546399        6.40312423743285        0
17       5.83095189484530        2                       3.60555127546399        4.12310562561766        4.12310562561766        6.32455532033676        2.23606797749979        5                       6.40312423743285        5.83095189484530        2.23606797749979        6.32455532033676        4.12310562561766        2.23606797749979        1                       4                       0                       6.70820393249937        6.32455532033676        3                       3.16227766016838        3                       2.23606797749979        3.60555127546399        3.16227766016838        5                       2.23606797749979        3.60555127546399        5                       4
18       9.21954445729289        8.54400374531753        10                      4.47213595499958        5.09901951359278        1                       4.47213595499958        7.61577310586391        1.41421356237310        6.08276253029822        5.65685424949238        1                       5.09901951359278        4.47213595499958        6.32455532033676        6.08276253029822        6.70820393249937        0                       1                       4.24264068711929        5                       6                       5.65685424949238        8                       9.21954445729289        11.4017542509914        7.07106781186548        3.16227766016838        3.16227766016838        6.08276253029822
19       9.48683298050514        8.24621125123532        9.43398113205660        3.60555127546399        5.38516480713450        0                       4.12310562561766        6.70820393249937        2.23606797749979        5.09901951359278        5                       0                       5.38516480713450        4.12310562561766        6.08276253029822        6.32455532033676        6.32455532033676        1                       0                       3.60555127546399        5.09901951359278        6.08276253029822        5                       8.06225774829855        8.60232526704263        10.8166538263920        6.40312423743285        3                       2.23606797749979        6.32455532033676
20       7.81024967590665        5                       5.83095189484530        1.41421356237310        4.47213595499958        3.60555127546399        1.41421356237310        4                       4.47213595499958        3.60555127546399        1.41421356237310        3.60555127546399        4.47213595499958        1.41421356237310        3.16227766016838        5                       3                       4.24264068711929        3.60555127546399        0                       3.60555127546399        4.24264068711929        1.41421356237310        5.83095189484530        5                       7.21110255092798        2.82842712474619        2                       2                       5
21       4.47213595499958        4.24264068711929        6.70820393249937        5                       1                       5.09901951359278        2.23606797749979        7.28010988928052        4.12310562561766        7.21110255092798        4.12310562561766        5.09901951359278        1                       2.23606797749979        2.23606797749979        1.41421356237310        3.16227766016838        5                       5.09901951359278        3.60555127546399        0                       1                       4.12310562561766        3                       6.32455532033676        8.06225774829855        5                       2.23606797749979        5                       1.41421356237310
22       3.60555127546399        3.60555127546399        6.32455532033676        5.65685424949238        1.41421356237310        6.08276253029822        2.82842712474619        7.61577310586391        5.09901951359278        7.81024967590665        4.47213595499958        6.08276253029822        1.41421356237310        2.82842712474619        2                       1                       3                       6                       6.08276253029822        4.24264068711929        1                       0                       4.47213595499958        2                       6.08276253029822        7.61577310586391        5.09901951359278        3.16227766016838        5.83095189484530        1
23       7.81024967590665        4.12310562561766        4.47213595499958        2                       5.09901951359278        5                       2                       3.16227766016838        5.83095189484530        3.60555127546399        0                       5                       5.09901951359278        2                       2.82842712474619        5.38516480713450        2.23606797749979        5.65685424949238        5                       1.41421356237310        4.12310562561766        4.47213595499958        0                       5.65685424949238        3.60555127546399        5.83095189484530        1.41421356237310        3.16227766016838        3.16227766016838        5.38516480713450
24       2.23606797749979        3                       6                       7.21110255092798        3.16227766016838        8.06225774829855        4.47213595499958        8.60232526704263        7.07106781186548        9.21954445729289        5.65685424949238        8.06225774829855        3.16227766016838        4.47213595499958        2.82842712474619        2.23606797749979        3.60555127546399        8                       8.06225774829855        5.83095189484530        3                       2                       5.65685424949238        0                       6.08276253029822        7.07106781186548        5.83095189484530        5.09901951359278        7.61577310586391        2.23606797749979
25       8.24621125123532        3.16227766016838        1                       5.38516480713450        7.28010988928052        8.60232526704263        5                       4.12310562561766        9.21954445729289        6                       3.60555127546399        8.60232526704263        7.28010988928052        5                       4.12310562561766        7.07106781186548        3.16227766016838        9.21954445729289        8.60232526704263        5                       6.32455532033676        6.08276253029822        3.60555127546399        6.08276253029822        0                       2.23606797749979        2.23606797749979        6.40312423743285        6.70820393249937        7.07106781186548
26       9                       4.12310562561766        1.41421356237310        7.61577310586391        8.94427190999916        10.8166538263920        7.07106781186548        6                       11.3137084989848        8.06225774829855        5.83095189484530        10.8166538263920        8.94427190999916        7.07106781186548        5.83095189484530        8.54400374531753        5                       11.4017542509914        10.8166538263920        7.21110255092798        8.06225774829855        7.61577310586391        5.83095189484530        7.07106781186548        2.23606797749979        0                       4.47213595499958        8.48528137423857        8.94427190999916        8.54400374531753
27       8.06225774829855        3.60555127546399        3.16227766016838        3.16227766016838        6                       6.40312423743285        3.16227766016838        2.82842712474619        7.21110255092798        4.12310562561766        1.41421356237310        6.40312423743285        6                       3.16227766016838        3.16227766016838        6.08276253029822        2.23606797749979        7.07106781186548        6.40312423743285        2.82842712474619        5                       5.09901951359278        1.41421356237310        5.83095189484530        2.23606797749979        4.47213595499958        0                       4.47213595499958        4.47213595499958        6.08276253029822
28       6.70820393249937        5.38516480713450        7.07106781186548        3.16227766016838        2.82842712474619        3                       1.41421356237310        6                       2.82842712474619        5.38516480713450        3.16227766016838        3                       2.82842712474619        1.41421356237310        3.16227766016838        3.60555127546399        3.60555127546399        3.16227766016838        3                       2                       2.23606797749979        3.16227766016838        3.16227766016838        5.09901951359278        6.40312423743285        8.48528137423857        4.47213595499958        0                       2.82842712474619        3.60555127546399
29       9.43398113205660        7                       7.61577310586391        1.41421356237310        5.65685424949238        2.23606797749979        3.16227766016838        4.47213595499958        4                       3                       3.16227766016838        2.23606797749979        5.65685424949238        3.16227766016838        5.09901951359278        6.40312423743285        5                       3.16227766016838        2.23606797749979        2                       5                       5.83095189484530        3.16227766016838        7.61577310586391        6.70820393249937        8.94427190999916        4.47213595499958        2.82842712474619        0                       6.40312423743285
30       3.16227766016838        4.47213595499958        7.28010988928052        6.40312423743285        1                       6.32455532033676        3.60555127546399        8.54400374531753        5                       8.60232526704263        5.38516480713450        6.32455532033676        1                       3.60555127546399        3                       0                       4                       6.08276253029822        6.32455532033676        5                       1.41421356237310        1                       5.38516480713450        2.23606797749979        7.07106781186548        8.54400374531753        6.08276253029822        3.60555127546399        6.40312423743285        0;
variable
z        cost
q(i,j,k,l)  New variable;
binary variable
x(i,j)      The assignment;
Positive variable q;
equation
objective
e1
e2
e3
e4;
objective..z=e=sum((i,j),c(i,j)*x(i,j))+sum((i,j,k,l), d(i,k)*f(j,l)*q(i,j,k,l)) ;
e1(j)..sum(i,x(i,j))=e=1;
e2(i)..sum(j,x(i,j)*a(i,j))=l=b(i);
e3(j,l,k)..sum(i,q(i,j,k,l))=e=x(k,l);
e4(j,l,k)..sum(i,q(k,l,i,j))=e=x(k,l);


model    GQAPR2/all/
option
mip=cplex
RESLIM = 3600;
solve    GQAPR2      using   mip      minimizing      z;
display  x.l,z.l;
